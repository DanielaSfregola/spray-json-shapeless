build_image: ensime/ensime:latest

script:
  - sbt ++$SCALA_VERSION clean test:compile doc &&
    if [ $(git diff | wc -l) -ge 1 ] ; then
      echo "Code formatting does not meet the project's standards:" ;
      git --no-pager diff ;
      exit 1 ;
    fi &&
    sbt ++$SCALA_VERSION test &&
    if [ "$PULL_REQUEST" = "false" ] ; then
      sbt ++$SCALA_VERSION publish ;
    fi

# BLOCKED https://github.com/scoverage/sbt-coveralls/pull/41
#- sbt ++$SCALA_VERSION clean coverage test &&
#  sbt coveralls

# Reminder: set the following encrypted variables on one line:
#
#   SONATYPE_USERNAME
#   SONATYPE_PASSWORD
#   COVERALLS_REPO_TOKEN
#
# WORKAROUND https://github.com/Shippable/support/issues/1198
env:
  global:
    - SCALA_VERSION=2.11.7
    - AKKA_TEST_TIMEFACTOR=10
    - EMACS=/opt/emacs-24.1/bin/emacs
    - COVERALLS_REPO_TOKEN=ZvySxEAk6j3KcqFbOqYnpgFL5payQgVUM
    - secure: YuFgEdRwR9XkMKR/EYWz4ZpjHueOpI/0yNydkEukLYltVfGVdZf2+BC7bz5cWjOWixaHuehK1yCQjXTrigMlZ8Gtcf9/55msj+Abu2+H1e0JKyBZNdn6V8Q3bmV0RjYhtezihCd+I/mSxAGKNybUC9bHyJvCCz7QlMgGL5/fFOiemOz4Eo74amh3fRnQw0Usfiu/TidT5/F/Da9UXI7GFsrqoy+dL54Z+WLZD4Bmm6tD/CZ3L6F8xMRDwxDVC1IvF1WSS2895dS5dRFjV0jH72tpHYruhvBdkgpTKw9/pjLI2S4SBDzniGfIXjq6oASHg8Dvkaret/po7roGscOOMw==

